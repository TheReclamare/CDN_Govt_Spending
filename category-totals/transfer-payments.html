<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer Payments — All Years Combined - Canadian Government Spending</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #ffffff;
            color: #333;
            padding: 20px;
            line-height: 1.4;
        }
        
        header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #666;
            font-size: 0.9rem;
        }
        
        nav {
            margin: 15px 0;
            font-size: 0.85rem;
            display: flex;
            flex-wrap: wrap;
            gap: 8px 20px;
        }
        
        nav a {
            color: #0066cc;
            text-decoration: none;
        }
        
        nav a:hover {
            text-decoration: underline;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-box {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
            width: 300px;
            max-width: 100%;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #0066cc;
        }
        
        .row-count {
            color: #666;
            font-size: 0.85rem;
        }
        
        .table-container {
            overflow-x: auto;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            max-height: 75vh;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }
        
        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            white-space: nowrap;
            user-select: none;
        }
        
        th:hover {
            background: #e8e8e8;
        }
        
        th .sort-arrow {
            margin-left: 5px;
            color: #999;
            font-size: 0.7rem;
        }
        
        th.sorted-asc .sort-arrow {
            color: #0066cc;
        }
        
        th.sorted-asc .sort-arrow::after {
            content: '▲';
        }
        
        th.sorted-desc .sort-arrow {
            color: #0066cc;
        }
        
        th.sorted-desc .sort-arrow::after {
            content: '▼';
        }
        
        th:not(.sorted-asc):not(.sorted-desc) .sort-arrow::after {
            content: '⇅';
        }
        
        td {
            border-bottom: 1px solid #eee;
            padding: 8px;
            vertical-align: top;
        }
        
        tr:hover {
            background: #f8f8f8;
        }
        
        .money {
            text-align: right;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        .negative {
            color: #c00;
        }
        
        footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            font-size: 0.8rem;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Transfer Payments — All Years Combined</h1>
        <p class="subtitle">Total spending by recipient 2015-2025</p>
    </header>
    
    <nav>
        <a href="../">← Home</a>
        <a href="../merged/transfer-payments/">Merged by Year</a>
        <a href="../verbatim/transfer-payments/">Verbatim Data</a>
    </nav>
    
    <div class="controls">
        <input type="text" class="search-box" id="searchBox" placeholder="Search all columns..." disabled>
        <span class="row-count" id="rowCount">Loading data...</span>
    </div>
    
    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Ministry<span class="sort-arrow"></span></th>
                    <th>Purpose<span class="sort-arrow"></span></th>
                    <th>Recipient<span class="sort-arrow"></span></th>
                    <th>Amount<span class="sort-arrow"></span></th>
                    <th>Years Active<span class="sort-arrow"></span></th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="5" class="loading">Loading 113,514 rows...</td></tr>
            </tbody>
        </table>
    </div>
    
    <footer>
        <p>Source: Government of Canada Public Accounts | Data presented as published</p>
    </footer>
    
    <script>
        let allData = [];
        let filteredData = [];
        
        function formatMoney(value) {
            const num = parseFloat(value);
            if (isNaN(num)) return value;
            if (num < 0) {
                return '-$' + Math.abs(num).toLocaleString('en-CA', {maximumFractionDigits: 0});
            }
            return '$' + num.toLocaleString('en-CA', {maximumFractionDigits: 0});
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            const html = data.map(row => {
                const amount = parseFloat(row[3]);
                const moneyClass = amount < 0 ? 'money negative' : 'money';
                return `<tr>
                    <td>${escapeHtml(row[0])}</td>
                    <td>${escapeHtml(row[1])}</td>
                    <td>${escapeHtml(row[2])}</td>
                    <td class="${moneyClass}">${formatMoney(row[3])}</td>
                    <td>${escapeHtml(row[4])}</td>
                </tr>`;
            }).join('');
            tbody.innerHTML = html;
        }
        
        function parseCSV(text) {
            const rows = [];
            let current = '';
            let inQuotes = false;
            let row = [];
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    row.push(current);
                    current = '';
                } else if ((char === '\n' || (char === '\r' && nextChar === '\n')) && !inQuotes) {
                    if (char === '\r') i++;
                    row.push(current);
                    if (row.length > 1 || row[0] !== '') {
                        rows.push(row);
                    }
                    row = [];
                    current = '';
                } else if (char !== '\r') {
                    current += char;
                }
            }
            if (current || row.length > 0) {
                row.push(current);
                rows.push(row);
            }
            return rows;
        }
        
        async function loadData() {
            try {
                const response = await fetch('transfer-payments.csv');
                const text = await response.text();
                const rows = parseCSV(text);
                
                // Skip header row
                allData = rows.slice(1);
                filteredData = allData;
                
                renderTable(allData);
                
                document.getElementById('searchBox').disabled = false;
                document.getElementById('rowCount').textContent = 
                    `Showing ${allData.length.toLocaleString()} of ${allData.length.toLocaleString()} rows`;
                
                // Enable sorting
                setupSorting();
                
            } catch (error) {
                document.getElementById('tableBody').innerHTML = 
                    `<tr><td colspan="5" class="loading">Error loading data: ${error.message}</td></tr>`;
            }
        }
        
        function setupSorting() {
            const headers = document.querySelectorAll('th');
            headers.forEach((th, index) => {
                th.addEventListener('click', function() {
                    const isAsc = this.classList.contains('sorted-asc');
                    
                    headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
                    this.classList.add(isAsc ? 'sorted-desc' : 'sorted-asc');
                    
                    filteredData.sort((a, b) => {
                        let aVal = a[index] || '';
                        let bVal = b[index] || '';
                        
                        // Check if money column (index 3)
                        if (index === 3) {
                            aVal = parseFloat(aVal) || 0;
                            bVal = parseFloat(bVal) || 0;
                            return isAsc ? aVal - bVal : bVal - aVal;
                        }
                        
                        return isAsc 
                            ? aVal.localeCompare(bVal) 
                            : bVal.localeCompare(aVal);
                    });
                    
                    renderTable(filteredData);
                });
            });
        }
        
        // Filter functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const filter = e.target.value.toLowerCase();
            
            if (filter === '') {
                filteredData = allData;
            } else {
                filteredData = allData.filter(row => 
                    row.some(cell => cell.toLowerCase().includes(filter))
                );
            }
            
            renderTable(filteredData);
            document.getElementById('rowCount').textContent = 
                `Showing ${filteredData.length.toLocaleString()} of ${allData.length.toLocaleString()} rows`;
        });
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
